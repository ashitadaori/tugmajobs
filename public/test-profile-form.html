<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Profile Form</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .debug-info { background: #f8f9fa; padding: 15px; margin: 20px 0; border-left: 4px solid #007bff; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Profile Update Test Form</h1>
    
    <div class="debug-info">
        <h3>Debug Information:</h3>
        <p><strong>Form Action:</strong> <span id="form-action"></span></p>
        <p><strong>Current URL:</strong> <span id="current-url"></span></p>
        <p><strong>CSRF Token:</strong> <span id="csrf-token">Loading...</span></p>
    </div>

    <form id="test-form" method="POST" action="/employer/profile">
        <input type="hidden" name="_token" id="csrf-input" value="">
        
        <div class="form-group">
            <label for="company_name">Company Name *</label>
            <input type="text" name="company_name" id="company_name" value="Test Company Update" required>
        </div>

        <div class="form-group">
            <label for="company_description">Company Description</label>
            <textarea name="company_description" id="company_description" rows="4">This is a test update to verify form submission works correctly.</textarea>
        </div>

        <div class="form-group">
            <label for="industry">Industry</label>
            <select name="industry" id="industry">
                <option value="technology">Technology</option>
                <option value="healthcare">Healthcare</option>
                <option value="finance">Finance</option>
                <option value="education">Education</option>
            </select>
        </div>

        <div class="form-group">
            <label for="company_size">Company Size</label>
            <select name="company_size" id="company_size">
                <option value="1-10">1-10 employees</option>
                <option value="11-50">11-50 employees</option>
                <option value="51-200" selected>51-200 employees</option>
                <option value="201-500">201-500 employees</option>
            </select>
        </div>

        <div class="form-group">
            <label for="website">Website</label>
            <input type="url" name="website" id="website" value="https://test-company.com">
        </div>

        <div class="form-group">
            <label for="location">Location</label>
            <input type="text" name="location" id="location" value="Test Location">
        </div>

        <div class="form-group">
            <label for="contact_email">Contact Email</label>
            <input type="email" name="contact_email" id="contact_email" value="test@example.com">
        </div>

        <div class="form-group">
            <label for="contact_phone">Contact Phone</label>
            <input type="tel" name="contact_phone" id="contact_phone" value="+1234567890">
        </div>

        <div class="form-group">
            <label for="founded_year">Founded Year</label>
            <input type="number" name="founded_year" id="founded_year" value="2020" min="1800" max="2025">
        </div>

        <button type="submit">Update Profile</button>
    </form>

    <div id="status-message" style="margin-top: 20px;"></div>

    <script>
        // Set debug information
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('form-action').textContent = document.getElementById('test-form').action;

        // Try to get CSRF token
        fetch('/employer/profile')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const csrfToken = doc.querySelector('meta[name="csrf-token"]');
                
                if (csrfToken) {
                    const token = csrfToken.getAttribute('content');
                    document.getElementById('csrf-token').textContent = token;
                    document.getElementById('csrf-input').value = token;
                } else {
                    document.getElementById('csrf-token').innerHTML = '<span class="error">Not found in page meta</span>';
                }
            })
            .catch(error => {
                document.getElementById('csrf-token').innerHTML = '<span class="error">Error fetching token: ' + error.message + '</span>';
            });

        // Handle form submission
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const statusDiv = document.getElementById('status-message');
            
            statusDiv.innerHTML = '<div style="color: blue;">Submitting form...</div>';
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                const contentType = response.headers.get('content-type');
                statusDiv.innerHTML = `
                    <div><strong>Response Status:</strong> ${response.status} ${response.statusText}</div>
                    <div><strong>Content Type:</strong> ${contentType}</div>
                `;
                
                if (response.ok) {
                    statusDiv.innerHTML += '<div class="success">✓ Form submitted successfully!</div>';
                    if (contentType && contentType.includes('json')) {
                        return response.json();
                    } else {
                        return response.text();
                    }
                } else {
                    statusDiv.innerHTML += '<div class="error">✗ Form submission failed!</div>';
                    return response.text();
                }
            })
            .then(data => {
                console.log('Response:', data);
                if (typeof data === 'string') {
                    // If it's HTML (redirect response), show first 500 characters
                    statusDiv.innerHTML += `<div><strong>Response Preview:</strong><br><pre style="background: #f8f9fa; padding: 10px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">${data.substring(0, 500)}...</pre></div>`;
                } else {
                    statusDiv.innerHTML += `<div><strong>Response Data:</strong><br><pre style="background: #f8f9fa; padding: 10px;">${JSON.stringify(data, null, 2)}</pre></div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.innerHTML += `<div class="error"><strong>Network Error:</strong> ${error.message}</div>`;
            });
        });
    </script>
</body>
</html>
